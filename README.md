
# A miniature Javascript animation framework.
Animation framework to demonstrate cource code examples. 

Will replace the source code example runner in the 
[it001](https://github.com/ustegrew/ustegrew.github.io) course. The 
present source code example runner is very cumbersome to integrate
into the site which makes maintenance difficult.

Note that this project is still in very early stages. 

I've looked high and low on the internet to find a Javascript execution environment which can be embedded into a web page and works like the  debugger as found in Chrome or Firefox. Specifically, I'm looking for an environment which  

1. Allows me to step through a program line,
2. Allows me to query any object at any time,
3. Can be embedded into a web page (i.e. visually and functionally),
4. Works out of the box, i.e. without the need of installing a browser extension.

Requirement 1 and 2 are easy to fulfill, as Chrome and Firefox have inbuilt debuggers which allow line-by-line stepping and variable querying. However, requirements 3 and 4 aren't supported by any browser. The debuggers provided by Chrome and Firefox are fine for development, but too clunky for a learning environment. 
 
* Bringing the debugger up requires the user to press a complicated key combination (Finger acrobatic) or click some ominous menu item (requiring several mouse clicks). That's fine for a one-off, but it's distracting when following the teaching text with multiple examples per page.
* The browser inbuilt debugger splits the window or opens in a separate window which is another distraction as the teaching text either scrolls or gets covered by the debugger.

I have tried several approaches, none of which yielded usable results. I tried to:

* Access the web browser's debugger API in Javascript, allowing me to 'remote control' it from the web page itself.
* Find a Javascript interpreter written in Javascript, to run the code examples. There was one hopeful [candidate](https://github.com/NeilFraser/JS-Interpreter) which allows me to step through Javascript code - but it's hard to retrieve the stored data.

Therefore I'm exploring whether it's possible to create an independent execution model which operates sufficiently to demonstrate the programming concepts shown in the `it001` course in a line-by-line-stepping fashion.


## Novel approach to Javascript development...
At least for me! Some time ago I discovered the [JSweet framework](http://www.jsweet.org).
JSweet allows me to code in Java and reap the benefits in Javascript. This gives me the type 
safety of Java (plus good tooling support eg. when refactoring code). That's why this project
looks like a Java project (as most source files are written in Java). However, when compiling
the project, JSweet trans-piles my Java code into working Javascript. Using JSweet made
Javascript development so much easier for me!

In this project, JSweet compiles the Java code into a single Javascript file 
(`target/dist/bundle.js`). I use that file in the index page (`src/treewalk/index.html`).
The `bundle.js` file works out of the box in my web browser (Tested with chromium 51 and firefox 48).

## On linguistics in Javascript
... Or: How I can make Javascript execute programs in an arbitrary language? The current `it001` 
code example runner is very cumbersome to program (via a JSON file). By contrast, the microanim
framework uses it's own animation custom language. It allows to write examples animations as 
a series of simple commands which makes it much easier to integrate microanim into a web page. 

To make the framework follow the commands of the custom language we need a parser that can 
understand the custom language. I could try to hand-code that parser, but that would be very time 
consuming (also, I haven't got any experience in hand coding parsers). Thankfully I found a
[parser generator](http://pegjs.org) that can generate a Javascript parser from a 
Parser Expression Grammar (PEG). This means that I can design the animation language and then let
pegjs generate the parser which understands the animation language.

In this project, the PEG for the animation language is defined in 
`target/lib/lang_anim/lanim.pegjs`, and the parser generated by `pegjs` is stored as
`target/lib/lang_anim/parser.js`. The parser is very easy to use. Minimum example:

	<html>
	    <head>
	        <script src="path/to/parser.js"/>
	        <script>
	            function translate ()
	            {
	                var src;
	                var out;
	                var parsed;
                   
                   out           = document.getElementById("parsed");
                   
                   /* Retrieve animation script */
                   src           = document.getElementById("code").innerText;
                   
                   /* Parse the script. Result is a JSON record. */
                   parsed        = lang_anim.parse (src);
                   
                   /* Write pretty printed JSON record back to this document. */  
                   out.innerText = JSON.stringify (parsed, null, 4);
	            }
	        </script>
	    </head>
	    <body onload="translate">
	        <pre id="code">
                # ----------------------------------------------------------
                #                   Treewalk animation
                # A monkey walks the nodes of a directory tree, trying to 
                # find the banana...
                # ----------------------------------------------------------
                   
                # Load image resources (Sprites)
                LoadImg             (img_tree,              ../../target/img/tree/11.png,                   0)
                LoadImg             (img_banana,            ../../target/img/banana/banana.png,             1)
                LoadImg             (img_monkey_happy_01,   ../../target/img/monkey/monkey.happy.01.png,    2)
                LoadImg             (img_monkey_think_01,   ../../target/img/monkey/monkey.think.01.png,    2)
                LoadImg             (img_monkey_think_02,   ../../target/img/monkey/monkey.think.02.png,    2)
                LoadImg             (img_monkey_think_03,   ../../target/img/monkey/monkey.think.03.png,    2)
                LoadImg             (img_monkey_walk_01,    ../../target/img/monkey/monkey.walk.01.png,     2)
                LoadImg             (img_monkey_walk_02,    ../../target/img/monkey/monkey.walk.02.png,     2)
                   
                # Animation sequence
                # 1. Prepare all sprites 
                   
                # 1.1. Move tree to canvas pos (0, 0), set to invisible
                MoveTo              (img_tree, 0, 0, 0)
                SetTransparency     (img_tree, 0.0, 0)
	        </pre>
            <button onclick="translate">Translate this</button>
	        <pre id="parsed"></pre>
	    </body>
	</html>

## Dependencies
This project depends on various other libraries and frameworks. Thankfully, they don't need 
to be bound explicitly into each web page which uses microanim. Microanim loads all dependencies
automatically. 

## Reverse plug...
I don't have intentions to develop this project into a fully blown animation engine. It's 
primarily for personal learning, and it's meant to provide simple animations which I can 
use in the it001 course. 

If you are looking for an animation/gaming framework that you can use now then 
there are already many frameworks out there. For an overview, see
[here](https://html5gameengine.com) and [here](https://en.wikipedia.org/wiki/List_of_game_engines).
 
Games engines I've tried in the past / would like to try in the future:
*   [Godot engine](http://godotengine.org)
*   [crafty js](http://craftyjs.com)
